# proxmoxを使おう！

### -- 目次 --
- [はじめに用意しておくもの](#はじめに用意しておくもの)
- [手順の中で出てくるもの](#手順の中で出てくるもの)
- [1 前準備～インストール](#1-前準備インストール)
- [2 GUIコンソールログイン](#2-GUIコンソールログイン)
- [3 VMとCTを作ろう](#3-VMとCTを作ろう)
- [4 SPICEを使おう](#4-SPICEを使おう)
- [5 リモートブートしてみよう](#5-リモートブートしてみよう)
- [なんか困ったとき](#なんか困ったとき)

---

### はじめに用意しておくもの
- インターネット接続できてUSBかCDが使えるPC
- 4GB以上のUSBかCD  
（proxmoxのインストールに使う。筆者は16GBのUSBにした）
- いらないPC
- 光回線（有線。いらないPCに繋げたい）

### 手順の中で出てくるもの
リンク先はDLサイトだよ。  
isoファイルはDLに時間かかるので、あらかじめDLしといた方が無駄がないかもー
- [proxmox-ve_X.X-X.iso](https://www.proxmox.com/en/downloads/proxmox-virtual-environment/iso)
- [Rufus](https://rufus.ie/ja/#google_vignette)
（インストールディスク作るのに使うソフト。インストール不要）
- [ubuntu-XX.XX.X-desktop-amd64.iso](https://jp.ubuntu.com/download)

---

## 1 前準備～インストール

 1. proxmox-ve_X.X-X.isoをサイトからDLする（最新版でいいよ）
 2. 1は時間かかるので、その間にRufusをDL
 3. isoがDL終わったらRufusを使ってインストールディスクを作る
	 > デバイス：用意しといたUSBとかCDを指定。  
	 > ブートの種類：「選択」ボタンからproxmoxのisoファイルを指定。  
	 > 他はいじらずスタートでいい。  
	 > ちょっと時間かかるので飲み物でも飲んでてね。
 4. いらないPCにインストールディスクを挿してUSBブートとかする
	> 電源入れた後ロゴ出てからF12キーとか連打するといいよ。  
	> キーの種類はPCのメーカーによって違うみたいだから各々調べてね。  
	> 成功したらブートのやり方選択みたいなの出るから、USB Memoryとかって書いてあるBoot方法を選んで。  
	> BIOS設定からUSBの優先順位を上げるやり方もある。
 5. **P　R　O　X　M　O　X**って出てきたらInstall Proxmox VE (Graphical)を選んでEnter
 6. インストール先のストレージ設定（いじらなくていい）
 7. 国設定（好きな国選んでね。Japanとか）
 8. スーパーユーザーとパスワードを設定
	> ここで入力したパスワードを使ってGUIコンソールに入るので、**パスワードは忘れないでね**。  
	> 忘れたらBootからやり直そう！！（1敗）  
	> メアドは使ってるやつでいい。システムから通知送られてくるよ。
 9. ホスト名とIPアドレスを設定する
	 > ここで決めたIPアドレスにアクセスしてGUIコンソールに入るよ。  
	 > 好きに決めていいけど、てきとうなPCからping送って返答ないやつにする（使ってないIP探す）とかしたほうがいい。 
	 > あとからでも変えられるけど、ここで決めとくといいかも。
 10. 設定項目確認画面がでてくるので確認してInstall
 11. 再起動されたあと別端末で **（9で設定したIP）:8006**って打つと、webコンソール画面に飛ぶ
	 > スマホからでも入れるぞ！入れるけどめっちゃ見づらい。ちょっと一回やってみてほしい。  
 	 > アプリからならきれいに映るよ。   
	 > [iosアプリはこっち](https://apps.apple.com/jp/app/proxmox-ve-companion/id6748314140)  
	 > [Google App Storeはこっち](https://play.google.com/store/apps/details?id=com.proxmox.app.pve_flutter_frontend&pcampaignid=web_share)

---

## 2 GUIコンソールログイン
以降、日本語化してある前提で書いていくよ。
1. 接続はプライベートではありませんって出てくるけど進む
2. ユーザ名（root）と設定したパスワードを入力
   > 4つ目のドロップダウンリストから日本語にもできるよ。

---

## 3 VMとCTを作ろう
pveの中のlocalをクリックして、ISOイメージからubuntu-XX.XX.X-desktop-amd64.isoをアップロードしておいてね。

### VM作成
1. 右上の「VMを作成」って書いてある青いボタンを押す。
2. . 「全般」のノード、VM ID、名前を入力する。
    > ノード：pveとか。ドロップダウンリストから選べる。  
    > VM ID：100から自動で振られる。他のと被らなければ好きなの設定していい。  
    > 名前：何のOSかわかるように名前つけてあげて。
3. 「OS」で、3でアップロードしたISOイメージをドロップダウンから選ぶ。
4. 「システム」は既定のままでいい。
5. 「ディスク」でディスクサイズを設定する。Linuxなら32GiBでいい。
6. 「CPU」でコア数を設定。
    > VPNサーバー、webサーバーなど：1  
    > ファイルサーバーなど：2  
    > 後からでも変更できるよ。
7. 「メモリ」を設定。
    > Linux：4096MiBがいいとされてる  
    > WindowsServer：8192MiBにした方がいい。少ないとめっちゃ遅くなるらしい  
    > マシンを停止した後設定変更できるよ。
8. 「ネットワーク」を設定。ブリッジはデフォルトでOK。
9. 「確認」で完了。
10. 作ったVMマシンのコンソールに移って起動。「Try or install Ubuntu」。
    > サーバーとして使うなら最小インストールでいい。  
    > 設定はお好みで。
11. 再起動したらログイン画面が出る。（完了！）
	> Login：root  
	> Password：6で決めたやつ

### CT作成
1. localストレージのCTテンプレートを開く
2. テンプレ―トを押す
3. 出てくるウインドウの検索窓（右上）でubuntuを検索、新しいのをダウンロード（まあまあ時間かかる）
	> 2026/2/1現在、24.04がサポート期間が長いのでそっちの方がいいかも！(2敗)
4. TASK OKが出たらウインドウを消す
5. 右上の「CTを作成」を押す
6. 「全般」を設定
	> CT ID：他のCTやVMと被らない数字  
	> パスワード：忘れないやつ
7. 「テンプレート」を設定
	> テンプレート：1～4でダウンロードしたもの
8. 「ディスク」はデフォルトでいい
9. 「CPU」のコアは使いたい数入れる（2とか）
10. 「メモリ」を設定
	> メモリとスワップはわからなければ同じ数字でいい。用途によって変えよう。
11. 「ネットワーク」を設定
	> IPv4：静的、使われてないIPアドレス/24  
	> ゲートウェイ：ホスト（pveのネットワークから確認可）と同じやつ  
 	> IPv6：SLAAC
12. 「DNS」を設定
	> DNSサーバ：ホスト設定。192.168.xxx.1とか。
13. 「確認」から設定項目を確認、完了を押す
14. コンソールから起動、ログインしてみる
	> Login：root  
	> Password：6で決めたやつ

---

## 4 SPICEを使おう
1. Ubuntuの「端末」でSPICEをDL
	```cmd
	sudo apt-get install spice-vdagent
	```
 2. ゲスト側（webでproxmox見てる側）のコマンドプロンプトを使って	remote-viewerをDL
	```cmd
	winget install virt-viewre
	```
 3. 「ハードウェア」の「ディスプレイ」をSPICEにする
 4. 右上の「コンソール」を押すとSPICE起動

---

## 5 リモートブートしてみよう
### 起動したい側（今回はproxmox側）
1. BIOS設定からWake-on-LANを有効化する
2. pveのシェルを開く
3. WOLに対応してるか確認
	```cmd
	ethtool nic0
	```
	> nic0のとこに自分が使ってるnicの名前入れてね。(ip aとかで調べてね)
4. WOLを有効化
	```cmd
	ethtool -s nic0 wol g
	```
### 起動するのに使いたい端末側（今回はスマホ）
1. WOL(RemoteBoot WOLとか)のアプリを入れる
2. アプリにIPアドレスとMAC（あとポートもかも）を入れる
3. BOOTで起動できる

---

ここにGithubにアップロードしたJavaのプロジェクトをUbuntuCTにデプロイするやりかた書くね
privateだとパーソナルトークンっての作らなきゃいけないらしい

---

## なんか困ったとき
### apt updateとかinstallとかできないんだけど！
ネット繋がってないか、ファイアウォールで落とされてるか、Ubuntuのバージョンが古いかのどれかやね。  
1. もう一回ゲートウェイとかDNSとか確かめてみよう！  
2. ファイアウォール確認しよう！  
	デフォルトでファイアウォールが設定されてるケースがあるみたいだから、pveのシェルで下記コマンド打って確認してみてね。
	```cmd
	pct config <CT ID> | grep -i net
	```
	3つ目くらいにfirewallってのがあるので、そこが1なら下記コマンドでファイアウォールを切ろう。
	```cmd
	pct set <CT ID> -net0 ""
	```
	-net0のところと""の中にはpct config~の結果を入れるよ。読み替えてね。**firewall=0**にするのを忘れずに！  
	終わったら再起動。pct reboot <CT ID>とかね。

---

～なんかあったら追記します～
